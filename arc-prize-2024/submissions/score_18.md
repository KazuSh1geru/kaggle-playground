# 参考
https://www.kaggle.com/competitions/abstraction-and-reasoning-challenge/discussion/154597

### ARC-PRIZEというコンペのソリューション解説の翻訳

@fchollet氏がこのデータセットを作成し、コンペを開催してくれたことに感謝します。私は知能の理解と創造は非常に興味深いと感じており、この問題に取り組み、データセットの論文を読むことで、汎用人工知能（AGI）への見解が大きく変わりました。自分でモデルに事前知識と一般化を取り込む必要があると、その難しさが明確になります。コンテストが発表される前にすでに論文を読んでいましたが、コンテストを通じて、より実践的な視点が得られました。

残念ながら、私のソリューション自体がAGIに近づけるものではないと思います。主な要素は、DSL（ドメイン固有言語）で、142個の一元的な変換（42種類の関数、それぞれ複数のバリエーションあり）を最大4回適用するものです。このDSLは列挙法（重複の活用）と貪欲なスタック合成器を用いて解かれます。すべてはC++で効率的に実装され、依存関係はなく、並列処理で実行されています。

現在、コードは1万行を超えていますが、ほとんど使用されていない部分も多いため、未使用や失敗したコードを整理した後に公開する予定です。

- **Edit**: コードと公式ドキュメントは以下に公開されています：  
  [GitHub - ARC-solution](https://github.com/top-quarks/ARC-solution)  
  [公式ドキュメント (PDF)](https://github.com/top-quarks/ARC-solution/blob/master/ARC-solution_documentation.pdf)

- **Edit 2**: 0.794のスコアを達成した公開ノートブック：  
  [Kaggle - 1st place solution](https://www.kaggle.com/icecuber/arc-1st-place-solution)

---

### 開発の過程

最初は手作業で100個のトレーニングタスクを実装し、そこから有用な関数を抽出・一般化しました。これらの変換の組み合わせを総当たりで行う合成器を作成し、画像から単一の画像への変換だけをサポートするようにしました。当初は位置や色といった異なる型もサポートしようと考えていましたが、これらを画像として表現する方が簡単であると判明しました（例：位置に点を置いたり、特定の色の点を配置する）。この決定によりDSLの作成が容易になり、リーダーボード（LB）で10個のタスクを解くことができました。

その後、トレーニング、評価、LBの分布が異なることに気づき、評価用データセットをトレーニングデータとして使用することにしました。評価タスク100個を手作業で実装し、DSLを改善しました。さらに、一元的な関数に限定することで検索空間の爆発を防ぎました。また、画像のリスト型を追加し、ループが必要なタスクを解決できるようにしました。DSLを有向非巡回グラフ（DAG）で表現することで、重複を活用し、コードを再構築した結果、LBで14個のタスクを解くことができました。

---

### 主な解法ステップ

1. **入力の再カラーリング**  
   各サンプルの色を統一し、タスク間で一貫性を持たせます。これは、サンプルごとに異なる色を持つオブジェクトを同じ色に変換するためのものです。

2. **対角線で反転した画像の追加**  
   サンプルに対角反転したバージョンを追加し、3回のフル実行を行います。この追加により、17個から21個のタスクを解決できるようになりました。

3. **出力サイズの決定**  
   出力サイズを予測し、約97%の評価タスクで正しいサイズを得ました。

4. **変換されたピースの生成**  
   出力サイズに基づいて画像を変換し、ピースを生成します。

5. **ピースを重ねてトレーニングサンプルに一致させる**  
   グリーディなアプローチで、最適なピースを選んで重ねます。

6. **上位3つの候補の選定**  
   トレーニングデータに最も一致する候補を選びます。

---

### DSLの概要

DSLのノードは画像または画像リストで、各画像には位置、サイズ、2次元の色配列（0～9）が含まれます。黒（0）はほとんどの関数で透明として扱われます。

- 一元変換を順に適用し、最終的に「ピース」を生成します。
- ピースは複数の方法でスタックされ、最終的な出力画像が生成されます。

---

### 最適化と失敗したアイデア

- **グリーディなスタック戦略**が多くのタスクで効果を発揮しました。
- **複数の引数を持つ関数**の導入は検索空間を爆発させたため不採用。
- **MLアルゴリズムの適用**を検討しましたが、タスク生成の方が難しいと判断しました。

---

### 評価データセットの統計

- タスク総数：419  
- 正しい出力サイズの予測：97.6%  
- 候補の正答率：42%  
- 上位3つの候補での正答率：39%

---

### 変換の一覧

一部の関数は多くのバリエーションがありますが、一度だけ記載しています（例：「pickMax」には14種類のバリエーションがあります）。  
以下の関数を使用：`Fill, Move, border, compress, mirror, stackLine, toOrigin`など。各変換は画像または画像リストを入力し、他の画像またはリストを生成します。

これらの変換は効率的に実装されており、入力ピクセル数に比例する時間で実行されます。

---

このソリューションは、AGIへの直接の貢献は限られているものの、モデルの一般化と探索戦略に関する重要な学びを提供しています。